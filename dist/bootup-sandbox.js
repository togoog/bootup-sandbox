!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):(e=e||self).BootupSandbox=n()}(this,function(){"use strict";function i(e,n){for(var t=0;t<n.length;t++){var i=n[t];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var e=function(){function n(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,n),this.options=e,this.options.container=this.options.container||window.document.body,this.iframe=null,this.iframeWindow=null,this.iframeDocument=null,this._events={},this._isEnvReady=!1,this._init()}return function(e,n,t){n&&i(e.prototype,n),t&&i(e,t)}(n,[{key:"_init",value:function(){this.iframe=document.createElement("iframe"),this.setStyle({border:"none"}),this.options.container.appendChild(this.iframe),this.iframeWindow=this.iframe.contentWindow,this.iframeDocument=this.iframe.contentDocument,this.iframeDocument.open(),this.iframeDocument.write("<html><head></head><body></body></html>"),this.iframeDocument.close(),this.addEventListener(n.ENV_READY_EVENT_NAME,function(){this._isEnvReady=!0})}},{key:"setStyle",value:function(e){for(var n in e)e.hasOwnProperty(n)&&(this.iframe.style[n]=e[n]);return this}},{key:"injectScript",value:function(e,n){if(!e)return this;var t=this.iframeDocument.createElement("script"),i={};"function"==typeof n?i.onload=n:i=n,void 0===i.onload&&(i.onload=function(){}),void 0===i.onerror&&(i.onerror=function(){}),void 0===i.isSrc&&(i.isSrc=!1),void 0===i.remove&&(i.remove=!1),void 0===i.iife&&(i.iife=!0);var o=i.onload;i.onload=function(){o(),i.remove&&t.parentNode.removeChild(t)};var r=i.onerror;return i.onerror=function(){r(),console.error("injectScript fail",e)},i.isSrc?(t.onload=i.onload,t.onerror=i.onerror,t.src=e,this.iframeDocument.body.appendChild(t)):(i.iife?t.text="(function() {"+e+"})()":t.text=e,this.iframeDocument.body.appendChild(t),setTimeout(i.onload)),this}},{key:"ready",value:function(e){return this._isEnvReady?setTimeout(e.bind(this)):this.addEventListener(n.ENV_READY_EVENT_NAME,e),this}},{key:"addEventListener",value:function(t,i){var o=this,e=this._events[t];e||(e=this._events[t]=[]);var n=function(e){if(e&&e.data){var n=e.data.event;t===n&&i.apply(o,e.data,e)}};return e.push({originalHandler:i,handler:n}),window.addEventListener("message",n),this}},{key:"removeEventListener",value:function(e,n){var t=this._events[e];if(t&&0<t.length)if(n){var i=t.filter(function(e){return e.originalHandler===n})[0];i&&(t.splice(t.indexOf(i),1),window.removeEventListener("message",i.handler))}else t.forEach(function(e){window.removeEventListener("message",e.handler)}),delete this._events[e];return this}}]),n}();return e.ENV_READY_EVENT_NAME="ENV_READY",e});
