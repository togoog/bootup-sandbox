!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e=e||self).BootupSandbox=t()}(this,function(){"use strict";function o(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var e=function(){function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this.options=e,this.options.container=this.options.container||window.document.body,this.element=null,this.window=null,this.document=null,this._events={},this._isEnvReady=!1,this._isDestroy=!1,this._init()}return function(e,t,n){t&&o(e.prototype,t),n&&o(e,n)}(t,[{key:"_init",value:function(){this.element=document.createElement("iframe"),this.element.className="js-bootup-sandbox",this.setStyle({border:"none"}),this.options.beforeMount&&this.options.beforeMount.apply(this),this.options.container.appendChild(this.element);try{this.window=this.element.contentWindow,this.document=this.element.contentDocument||this.element.contentWindow.document,this.document.body||(this.document.open(),this.document.write("<html><head></head><body></body></html>"),this.document.close())}catch(e){console.error("获取沙箱关键对象失败",e)}this.addEventListener(t.ENV_READY_EVENT_NAME,function(){this._isEnvReady=!0})}},{key:"setStyle",value:function(e){for(var t in e)e.hasOwnProperty(t)&&(this.element.style[t]=e[t]);return this}},{key:"injectScript",value:function(e,t){if(!e)return this;var n=this.document.createElement("script");n.className="js-bootup-sandbox-script";var o={};"function"==typeof t?o.onload=t:t&&(o=t),void 0===o.onload&&(o.onload=function(){}),void 0===o.onerror&&(o.onerror=function(){}),void 0===o.contentIsSrc&&(o.contentIsSrc=!1),void 0===o.remove&&(o.remove=!1),void 0===o.iife&&(o.iife=!0);var i=o.onload;o.onload=function(){o.remove&&n.parentNode.removeChild(n),i()};var r=o.onerror;return o.onerror=function(){console.error("injectScript fail",e),r()},o.contentIsSrc?(n.onload=o.onload,n.onerror=o.onerror,n.src=e,this.document.body.appendChild(n)):(o.iife?n.text="(function() {"+e+"})()":n.text=e,this.document.body.appendChild(n),setTimeout(o.onload)),this}},{key:"ready",value:function(e){return this._isEnvReady?setTimeout(e.bind(this)):this.addEventListener(t.ENV_READY_EVENT_NAME,e),this}},{key:"addEventListener",value:function(o,i){var r=this,e=this._events[o];e||(e=this._events[o]=[]);var t=function(e){var t=e.data;if(t){var n=t.event;o===n&&i.call(r,e,t.data)}};return e.push({originalHandler:i,handler:t}),window.addEventListener("message",t),this}},{key:"removeEventListener",value:function(e,t){var n=this._events[e];if(n&&0<n.length)if(t){var o=n.filter(function(e){return e.originalHandler===t})[0];o&&(window.removeEventListener("message",o.handler),n.splice(n.indexOf(o),1))}else n.forEach(function(e){window.removeEventListener("message",e.handler)}),delete this._events[e];return this}},{key:"destroy",value:function(){for(var e in this._events)this.removeEventListener(e);this.options.container.removeChild(this.element),this._isDestroy=!0}}]),t}();return e.ENV_READY_EVENT_NAME="ENV_READY",e});
