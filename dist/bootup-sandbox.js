!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):(e=e||self).BootupSandbox=n()}(this,function(){"use strict";function i(e,n){for(var t=0;t<n.length;t++){var i=n[t];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var e=function(){function n(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,n),this.options=e,this.options.container=this.options.container||window.document.body,this.element=null,this.window=null,this.document=null,this._events={},this._isEnvReady=!1,this._init()}return function(e,n,t){n&&i(e.prototype,n),t&&i(e,t)}(n,[{key:"_init",value:function(){this.element=document.createElement("iframe"),this.element.className="js-bootup-sandbox",this.setStyle({border:"none"}),this.options.container.appendChild(this.element),this.window=this.element.contentWindow,this.document=this.element.contentDocument,this.document.open(),this.document.write("<html><head></head><body></body></html>"),this.document.close(),this.addEventListener(n.ENV_READY_EVENT_NAME,function(){this._isEnvReady=!0})}},{key:"setStyle",value:function(e){for(var n in e)e.hasOwnProperty(n)&&(this.element.style[n]=e[n]);return this}},{key:"injectScript",value:function(e,n){if(!e)return this;var t=this.document.createElement("script");t.className="js-bootup-sandbox-script";var i={};"function"==typeof n?i.onload=n:n&&(i=n),void 0===i.onload&&(i.onload=function(){}),void 0===i.onerror&&(i.onerror=function(){}),void 0===i.contentIsSrc&&(i.contentIsSrc=!1),void 0===i.remove&&(i.remove=!1),void 0===i.iife&&(i.iife=!0);var o=i.onload;i.onload=function(){i.remove&&t.parentNode.removeChild(t),o()};var r=i.onerror;return i.onerror=function(){console.error("injectScript fail",e),r()},i.contentIsSrc?(t.onload=i.onload,t.onerror=i.onerror,t.src=e,this.document.body.appendChild(t)):(i.iife?t.text="(function() {"+e+"})()":t.text=e,this.document.body.appendChild(t),setTimeout(i.onload)),this}},{key:"ready",value:function(e){return this._isEnvReady?setTimeout(e.bind(this)):this.addEventListener(n.ENV_READY_EVENT_NAME,e),this}},{key:"addEventListener",value:function(i,o){var r=this,e=this._events[i];e||(e=this._events[i]=[]);var n=function(e){var n=e.data;if(n){var t=n.event;i===t&&o.call(r,n.data,n,e)}};return e.push({originalHandler:o,handler:n}),window.addEventListener("message",n),this}},{key:"removeEventListener",value:function(e,n){var t=this._events[e];if(t&&0<t.length)if(n){var i=t.filter(function(e){return e.originalHandler===n})[0];i&&(t.splice(t.indexOf(i),1),window.removeEventListener("message",i.handler))}else t.forEach(function(e){window.removeEventListener("message",e.handler)}),delete this._events[e];return this}}]),n}();return e.ENV_READY_EVENT_NAME="ENV_READY",e});
